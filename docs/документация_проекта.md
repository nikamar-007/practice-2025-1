
# Документация проекта "Поли — Telegram-бот расписания"

## Описание

Проект "Поли" представляет собой Telegram-бота, ориентированного на автоматизацию работы с расписанием студентов и преподавателей Московского Политеха. Бот облегчает доступ к учебной информации, минимизирует ручной поиск, предоставляет персонализированные уведомления и поддерживает взаимодействие через простой текстовый интерфейс.

Сервис адаптирован под широкую аудиторию и учитывает особенности университетского расписания: выходные дни, перерывы и обновления в реальном времени.

---

## Технологии

**Основной стек:**
- **Платформа:** `JavaScript` (`Node.js`)
- **Хранилище данных:** `MySQL`
- **Коммуникация:** `Telegram Bot API`

**Инструменты и библиотеки:**
- `node-telegram-bot-api` — реализация интерфейса Telegram
- `axios` — обмен с внешними API (например, для получения расписания)
- `node-cron` — задачи по расписанию (ежедневные уведомления и т.д.)
- `moment-timezone` — работа с временными зонами и датами
- `chrono-node` — интерпретация произвольных текстовых дат
- `winston` — логирование в файл и консоль

---

## Структура кода

Архитектура проекта модульная и масштабируемая.

**Ключевые модули:**
- `core/bot.ts` — инициализация и запуск бота
- `commands/` — обработчики пользовательских команд
- `features/feedback.ts` — сбор обратной связи и передача администраторам
- `features/reminders.ts` — напоминания пользователям о парах
- `services/database.ts` — доступ к MySQL и операции с пользователями/группами
- `services/schedule.ts` — извлечение и форматирование расписания
- `state/sessionManager.ts` — управление временными состояниями пользователей
- `utils/logger.ts` — форматирование и вывод логов

---

## Возможности

### Обычные команды
- `/start` — приветствие и вводное меню
- `/help` — список доступных команд и справка
- `/day` — расписание на текущий день
- `/cur` — занятие, которое идёт прямо сейчас
- `/nextday` — расписание на завтра
- `/date [дата]` — расписание на произвольную дату
- `/add` — выбор или изменение группы пользователя
- `/settings` — напоминаний и пр.
- `/feedback` — возможность сообщить об ошибке или идее

### Команды для администраторов
- `/ban_user`, `/unban_user` — блокировка и разблокировка пользователей
- `/broadcast` — рассылка сообщения всем пользователям
- `/asks` — просмотр и ответы на входящие обращения
- `/list_bans`, `/list_blocked` — работа со списками пользователей
- `/add_holidays`, `/list_holidays` — учёт праздничных и выходных дней

---

## Система ролей

Права доступа реализованы в виде иерархии:
- **Superadmin** — полный доступ ко всем функциям
- **Trusted admin** — ограниченные привилегии: ответы на обращения, уведомления
- **Group admin** — дополнительные возможности в групповых чатах

Контроль ролей осуществляется через конфигурационный файл и отдельные сервисы проверки доступа.

---
## Команда проекта

### Баранов Вячеслав Иванович
**Роль:** Ведущий разработчик  
**Обязанности:**
- Разработка архитектуры бота
- Реализация основного функционала
- Работа с базой данных MySQL
- Интеграция с API университета
- Оптимизация производительности

**Контакты:**
- GitHub: [YaVyacheslav](https://github.com/YaVyacheslav)
- Telegram: [@OKAYANNYYYY](https://t.me/OKAYANNYYYY)

### Никаева Марьям Руслановна
**Роль:** UX/UI Дизайнер  
**Обязанности:**
- Проектирование пользовательского интерфейса
- Разработка дизайн-системы проекта
- Создание визуальной концепции
- Оптимизация пользовательского опыта

**Контакты:**
- GitHub: [nikamar-007](https://github.com/nikamar-007)
- Telegram: [@nikamar_007](https://t.me/nikamar_007)

## Обратная связь

Механизм обратной связи позволяет пользователям напрямую направлять сообщения в административный канал. Бот автоматически сохраняет сообщения в БД, пересылает модераторам и позволяет отвечать в режиме диалога.

Поддерживаются:
- текстовые сообщения
- изображения
- документы
- видео и голосовые сообщения

---

## Управление сессиями

Состояния диалогов обрабатываются с использованием промежуточного хранилища. Это обеспечивает корректную последовательность шагов в многошаговых командах, например при настройке группы.

Сессии автоматически сбрасываются через заданное время бездействия.

---

## Конфигурация

Переменные окружения хранятся в `.env`:

- `BOT_TOKEN`
- `BOT_USERNAME`
- `API_USERNAME` / `API_PASSWORD`
- `DB_HOST`, `DB_NAME`, `DB_USER`, `DB_PASS`
- `ADMIN_IDS`, `CHANNEL_ID` и др.

---

## Безопасность и защита

Реализованы:
- антиспам-фильтр по частоте сообщений
- валидация входных данных
- ограничение на длину и формат сообщений
- централизованное логирование ошибок
- разделение пользовательских и административных действий

---

## Статистика и масштаб

- Более 250 активных пользователей ежедневно
- 5000+ строк кода
- 9 основных команд
- Поддержка подгрупп, индивидуальных настроек и каналов уведомлений

---

## Исходный код

Репозиторий проекта размещён на GitHub:  
https://github.com/edducon/schedule_bot

---

## Развёртывание

Бот может быть запущен локально или на сервере с помощью:

```bash
npm install
cp .env.example .env  # заполнить переменные
npm run start
```

---

© Проект "Поли", 2025 — [Политика конфиденциальности](https://telegra.ph/Politika-konfidencialnosti-Poli-03-23)
